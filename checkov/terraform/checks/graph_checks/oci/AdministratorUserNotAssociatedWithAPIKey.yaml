metadata:
  id: "CKV2_OCI_1"
  name: "Ensure administrator users are not associated with API keys"
  category: "IAM"
definition:
  or:
    - and:
      - resource_types:
          - oci_identity_group
        connected_resource_types:
          - oci_identity_user_group_membership
        operator: exists
        cond_type: connection
      - resource_types:
          - oci_identity_user_group_membership
        connected_resource_types:
          - oci_identity_user
        operator: exists
        cond_type: connection
      - cond_type: attribute
        attribute: name
        resource_types:
          - oci_identity_group
        operator: equals
        value: "Administrators"
      - resource_types:
          - oci_identity_user
        connected_resource_types:
          - oci_identity_api_key
        operator: not_exists
        cond_type: connection
    - and:
      - resource_types:
          - oci_identity_group
        connected_resource_types:
          - oci_identity_user_group_membership
        operator: exists
        cond_type: connection
      - resource_types:
          - oci_identity_user_group_membership
        connected_resource_types:
              - oci_identity_user
        operator: exists
        cond_type: connection
      - cond_type: attribute
        attribute: name
        resource_types:
          - oci_identity_group
        operator: not_equals
        value: "Administrators"
    - resource_types:
        - oci_identity_user_group_membership
      connected_resource_types:
        - oci_identity_user
      operator: not_exists
      cond_type: connection
    - cond_type: filter
      attribute: resource_type
      value:
        - oci_identity_user
      operator: within

