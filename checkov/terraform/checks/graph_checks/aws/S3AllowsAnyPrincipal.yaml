metadata:
  name: "Ensure S3 bucket policy does not allow an action with any Principal"
  category: "IAM"
  id: "CKV2_AWS_57"
definition:
  and:
      - cond_type: filter
        attribute: resource_type
        operator: within
        value:
          - data.aws_iam_policy_document
      - cond_type: connection
        resource_types:
          - data.aws_iam_policy_document
        connected_resource_types:
          - aws_s3_bucket_policy
        operator: exists
      - and:
        - cond_type: attribute
          resource_types:
            - data.aws_iam_policy_document
          attribute: "statement.[*].principals.identifiers[*]"
          operator: jsonpath_not_equals
          value: "*"
#      - cond_type: attribute
#        resource_types:
#          - data.aws_iam_policy_document
#        attribute: statement.principals.identifiers
#        operator: "equals"
#        value: "*"
