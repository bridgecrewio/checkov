metadata:
  name: "Ensure that Auto Scaling is enabled on your DynamoDB tables"
  id: "CKV2_AWS_16"
  category: "GENERAL_SECURITY"
definition:
  or:
    - and:
      - cond_type: filter
        attribute: resource_type
        value:
          - aws_dynamodb_table
        operator: within
      - cond_type: connection
        resource_types:
          - aws_dynamodb_table
        connected_resource_types:
          - aws_appautoscaling_target
        operator: exists
      - cond_type: connection
        resource_types:
          - aws_appautoscaling_target
        connected_resource_types:
          - aws_appautoscaling_policy
        operator: exists
      - or:
        - cond_type: attribute
          resource_types:
            - aws_dynamodb_table
          attribute: billing_mode
          operator: equals
          value: PROVISIONED
        - cond_type: attribute
          resource_types:
            - aws_dynamodb_table
          attribute: billing_mode
          operator: not_exists
      - cond_type: attribute
        resource_types:
          - aws_appautoscaling_target
        attribute: service_namespace
        operator: equals
        value: dynamodb
    - cond_type: attribute
      resource_types:
        - aws_dynamodb_table
      attribute: billing_mode
      operator: equals
      value: PAY_PER_REQUEST
