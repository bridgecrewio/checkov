metadata:
  name: "Ensure all data stored in the S3 bucket have versioning enabled"
  category: "BACKUP_AND_RECOVERY"
  id: "CKV_AWS_21"
definition:
  or:
    - cond_type: attribute
      resource_types:
        - aws_s3_bucket
      attribute: versioning.enabled
      operator: equals
      value: true
    - and:
        - cond_type: filter
          attribute: resource_type
          operator: within
          value:
            - aws_s3_bucket
        - cond_type: connection
          resource_types:
            - aws_s3_bucket
          connected_resource_types:
            - aws_s3_bucket_versioning
          operator: exists
        - cond_type: attribute
          resource_types:
            - aws_s3_bucket_versioning
          attribute: versioning_configuration.status
          operator: equals
          value: Enabled
