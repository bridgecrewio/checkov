metadata:
  id: "CKV2_AWS_19"
  name: "Ensure that all EIP addresses allocated to a VPC are attached to EC2 instances"
  category: "NETWORKING"
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - aws_eip
      operator: within
    - or:
        - cond_type: attribute
          resource_types:
            - aws_eip
          attribute: vpc
          operator: equals
          value: true
        - cond_type: attribute
          resource_types:
            - aws_eip
          attribute: domain
          operator: equals
          value: vpc
    - or:
        - resource_types:
            - aws_eip
          connected_resource_types:
            - aws_instance
          operator: exists
          cond_type: connection
        - and:
            - resource_types:
                - aws_eip_association
              connected_resource_types:
                - aws_instance
                - aws_eip
              operator: exists
              cond_type: connection
            - cond_type: attribute
              resource_types:
                - aws_eip_association
              attribute: instance_id
              operator: exists
        - resource_types:
            - aws_eip
          connected_resource_types:
            - aws_nat_gateway
          operator: exists
          cond_type: connection
        - resource_types:
            - aws_eip
          connected_resource_types:
            - aws_transfer_server
          operator: exists
          cond_type: connection
        - cond_type: attribute
          resource_types:
          - aws_eip
          attribute: instance
          operator: contains
          value: "module."
        - cond_type: attribute
          resource_types:
          - aws_eip
          attribute: instance
          operator: contains
          value: "data."
