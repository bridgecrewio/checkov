metadata:
  id: "CKV2_AWS_28"
  name: "cs-public-resource-based-policy-sqs"
  severity: "high"
  guidelines: "public resource based policy - sqs"
  category: "general"
scope:
  provider: "aws"
definition:
  or:
    - and:
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue"
          attribute: "policy.Statement[?(@.Effect == 'Allow' & @.Principal == '*')]"
          operator: "jsonpath_not_exists"
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue"
          attribute: "policy.Statement[?(@.Effect == 'Allow')].Principal.AWS[*]"
          operator: "jsonpath_not_equals"
          value: "*"
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue"
          attribute: "policy.Statement[?(@.Effect == 'Allow')].NotPrincipal"
          operator: "jsonpath_not_exists"
    - and:
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue_policy"
          attribute: "policy.Statement[?(@.Effect == 'Allow' & @.Principal == '*')]"
          operator: "jsonpath_not_exists"
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue_policy"
          attribute: "policy.Statement[?(@.Effect == 'Allow')].Principal.AWS[*]"
          operator: "jsonpath_not_equals"
          value: "*"
        - cond_type: "attribute"
          resource_types:
            - "aws_sqs_queue_policy"
          attribute: "policy.Statement[?(@.Effect == 'Allow')].NotPrincipal"
          operator: "jsonpath_not_exists"