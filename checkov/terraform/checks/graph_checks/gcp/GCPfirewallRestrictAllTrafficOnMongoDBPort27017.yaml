metadata:
  id: "CKV2_GCP_22"
  name: "Ensure firewall does NOT allow MongoDB traffic (port 27017)"
  category: "NETWORKING"

definition:
  or:
    - and:
        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "direction"
          operator: "equals_ignore_case"
          value: "INGRESS"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "source_ranges"
          operator: "not_contains"
          value: "0.0.0.0/0"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "source_ranges"
          operator: "not_contains"
          value: "0.0.0.0"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "source_ranges"
          operator: "not_contains"
          value: "::/0"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "source_ranges"
          operator: "not_contains"
          value: ":"

    - and:
        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "allow.*.ports"
          operator: "not_contains"
          value: 27017

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "allow.*.ports"
          operator: "not_contains"
          value: "27017"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "allow.*.ports"
          operator: "exists"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "allow.*.protocol"
          operator: "not_equals_ignore_case"
          value: "TCP"

        - cond_type: "attribute"
          resource_types: "google_compute_firewall"
          attribute: "allow.*.protocol"
          operator: "not_equals_ignore_case"
          value: "UDP"
