metadata:
  id: "CKV2_GCP_7"
  name: "Ensure that a MySQL database instance does not allow anyone to connect with administrative privileges"
  category: "IAM"
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - google_sql_database_instance
      operator: within
    - or:
        - resource_types:
            - google_sql_database_instance
          connected_resource_types:
            - google_sql_user
          operator: not_exists
          cond_type: connection
        - and:
            - resource_types:
                - google_sql_database_instance
              connected_resource_types:
                - google_sql_user
              operator: exists
              cond_type: connection
            - or:
                - cond_type: attribute
                  attribute: name
                  operator: not_starting_with
                  value: "root"
                  resource_types:
                    - google_sql_user
                - and:
                    - cond_type: attribute
                      attribute: name
                      operator: starting_with
                      value: "root"
                      resource_types:
                        - google_sql_user
                    - cond_type: attribute
                      attribute: password
                      operator: exists
                      resource_types:
                        - google_sql_user
