metadata: 
  id: "CKV2_AZURE_52"
  name: "Ensure Synapse SQL Pool has vulnerability assessment attached"
  category: "GENERAL_SECURITY"

definition:
  and:
    - resource_types:
        - azurerm_synapse_sql_pool
      connected_resource_types:
        - azurerm_synapse_sql_pool_security_alert_policy
      operator: exists
      cond_type: connection
    - resource_types:
        - azurerm_synapse_sql_pool_security_alert_policy
      connected_resource_types:
        - azurerm_synapse_sql_pool_vulnerability_assessment
      operator: exists
      cond_type: connection
    - cond_type: attribute
      resource_types:
        - azurerm_synapse_sql_pool_vulnerability_assessment
      attribute: 'recurring_scans.*.enabled'
      operator: equals
      value: true
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_synapse_sql_pool_security_alert_policy
      operator: within

    