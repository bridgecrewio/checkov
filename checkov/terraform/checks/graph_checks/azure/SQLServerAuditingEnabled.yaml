metadata:
  id: "CKV_AZURE_23"
  name: "Ensure that 'Auditing' is set to 'On' for SQL servers"
  category: "LOGGING"
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_sql_server
        - azurerm_mssql_server
      operator: within
    - or:
        - cond_type: attribute
          resource_types:
            - azurerm_sql_server
            - azurerm_mssql_server
          attribute: extended_auditing_policy
          operator: exists
        - and:
            - cond_type: filter
              attribute: resource_type
              value:
                - azurerm_mssql_server
              operator: within
            - cond_type: attribute
              resource_types:
                - azurerm_mssql_server_extended_auditing_policy
              attribute: server_id
              operator: exists
            - cond_type: connection
              resource_types:
                - azurerm_mssql_server_extended_auditing_policy
              connected_resource_types:
                - azurerm_mssql_server
              operator: exists
