metadata:
  id: "CKV2_AZURE_13"
  name: "Ensure that sql servers enables data security policy"
  category: "GENERAL_SECURITY"
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_sql_server
      operator: within
    - or:
      - resource_types:
          - azurerm_sql_server
        connected_resource_types:
          - azurerm_mssql_server_security_alert_policy
        operator:  not_exists
        cond_type: connection
      - and:
          - resource_types:
              - azurerm_sql_server
            connected_resource_types:
              - azurerm_mssql_server_security_alert_policy
            operator: exists
            cond_type: connection
          - resource_types:
              - azurerm_mssql_server_security_alert_policy
            operator: equals
            cond_type: attribute
            attribute: state
            value: "Enabled"