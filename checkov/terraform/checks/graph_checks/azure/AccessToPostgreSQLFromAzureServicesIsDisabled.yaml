metadata:
  id: "CKV2_AZURE_6"
  name: "Ensure 'Allow access to Azure services' for PostgreSQL Database Server is disabled"
  category: "GENERAL_SECURITY"
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_sql_server
      operator: within
    - or:
      - resource_types:
          - azurerm_sql_server
        connected_resource_types:
          - azurerm_sql_firewall_rule
        operator: not_exists
        cond_type: connection
      - and:
        - resource_types:
            - azurerm_sql_server
          connected_resource_types:
            - azurerm_sql_firewall_rule
          operator: exists
          cond_type: connection
        - cond_type: attribute
          resource_types:
             - azurerm_sql_firewall_rule
          attribute: start_ip_address
          value: "0.0.0.0"
          operator: not_equals
        - cond_type: attribute
          resource_types:
             - azurerm_sql_firewall_rule
          attribute: end_ip_address
          value: "0.0.0.0"
          operator: not_equals
