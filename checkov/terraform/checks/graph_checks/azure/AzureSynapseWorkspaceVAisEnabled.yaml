metadata:
  id: "CKV2_AZURE_46"
  name: "Ensure that Azure Synapse Workspace vulnerability assessment is enabled"
  category: "GENERAL_SECURITY"
definition:
    and:
      - resource_types:
          - azurerm_synapse_workspace_security_alert_policy
        connected_resource_types:
          - azurerm_synapse_workspace
        operator: exists
        cond_type: connection

      - resource_types:
          - azurerm_synapse_workspace_vulnerability_assessment
        connected_resource_types:
          - azurerm_synapse_workspace_security_alert_policy
        operator: exists
        cond_type: connection

      - cond_type: attribute
        resource_types:
          - azurerm_synapse_workspace_vulnerability_assessment
        attribute: 'recurring_scans.*.enabled'
        operator: equals
        value: true

      - cond_type: filter
        attribute: resource_type
        value:
          - azurerm_synapse_workspace_vulnerability_assessment
        operator: within

