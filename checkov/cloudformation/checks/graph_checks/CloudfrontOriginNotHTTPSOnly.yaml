metadata:
  id: "CKV2_AWS_72"
  name: "Ensure AWS CloudFront origin protocol policy enforces HTTPS-only"
  category: "NETWORKING"
definition:
  or:
    - cond_type: "attribute"
      resource_types:
        - "AWS::CloudFront::Distribution"
      attribute: "DistributionConfig.Enabled"
      operator: "equals"
      value: "false"
    - cond_type: "attribute"
      resource_types:
        - "AWS::CloudFront::Distribution"
      attribute: "DistributionConfig.Origins.*.CustomOriginConfig"
      operator: "not_exists"
    - and:
      - cond_type: "attribute"
        resource_types:
          - "AWS::CloudFront::Distribution"
        attribute: DistributionConfig.Origins[?(@.CustomOriginConfig.OriginProtocolPolicy != 'https-only')].DomainName
        operator: "jsonpath_not_contains"
        value: ".mediastore."
      - cond_type: "attribute"
        resource_types:
          - "AWS::CloudFront::Distribution"
        attribute: DistributionConfig.Origins[?(@.CustomOriginConfig.OriginProtocolPolicy != 'https-only')].DomainName
        operator: "jsonpath_not_contains"
        value: ".mediapackage."
      - cond_type: "attribute"
        resource_types:
          - "AWS::CloudFront::Distribution"
        attribute: DistributionConfig.Origins[?(@.CustomOriginConfig.OriginProtocolPolicy != 'https-only')].DomainName
        operator: "jsonpath_not_contains"
        value: ".elb."
